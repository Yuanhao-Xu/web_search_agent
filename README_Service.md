# Webæœç´¢æ™ºèƒ½ä½“æœåŠ¡

åŸºäºæ‚¨çš„å¤§æ¨¡å‹åŸºç±»å’Œä¸»ç¨‹åºï¼Œå°è£…è€Œæˆçš„Webæœç´¢æ™ºèƒ½ä½“æœåŠ¡ã€‚ä½¿ç”¨FastAPIæ¡†æ¶æä¾›RESTful APIæ¥å£ï¼Œæ”¯æŒæ™ºèƒ½æœç´¢ã€å¤šè½®å¯¹è¯å’Œå·¥å…·è°ƒç”¨ã€‚

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

- **æ™ºèƒ½æœç´¢**: åŸºäºTavilyæœç´¢å·¥å…·çš„æ™ºèƒ½ç½‘ç»œæœç´¢
- **å¤šè½®å¯¹è¯**: æ”¯æŒä¸Šä¸‹æ–‡è®°å¿†çš„å¤šè½®å¯¹è¯
- **å·¥å…·è°ƒç”¨**: è‡ªåŠ¨åˆ¤æ–­æ˜¯å¦éœ€è¦æœç´¢ï¼Œæ™ºèƒ½è°ƒç”¨å·¥å…·
- **æµå¼è¾“å‡º**: æ”¯æŒæµå¼å’Œéæµå¼ä¸¤ç§è¾“å‡ºæ¨¡å¼
- **APIè®¤è¯**: Bearer Tokenè®¤è¯æœºåˆ¶
- **å¥åº·æ£€æŸ¥**: æœåŠ¡çŠ¶æ€ç›‘æ§
- **å®Œæ•´æµ‹è¯•**: åŒ…å«å…¨é¢çš„æµ‹è¯•ä»£ç 

## ğŸ“ æ–‡ä»¶ç»“æ„

```
web_search_agent/
â”œâ”€â”€ web_search_agent_service.py  # ä¸»æœåŠ¡æ–‡ä»¶
â”œâ”€â”€ test_service.py              # æµ‹è¯•ä»£ç 
â”œâ”€â”€ requirements.txt             # ä¾èµ–åŒ…åˆ—è¡¨
â”œâ”€â”€ start_service.bat           # Windowså¯åŠ¨è„šæœ¬
â”œâ”€â”€ start_service.sh            # Linux/Macå¯åŠ¨è„šæœ¬
â”œâ”€â”€ run_tests.bat               # Windowsæµ‹è¯•è„šæœ¬
â”œâ”€â”€ run_tests.sh                # Linux/Macæµ‹è¯•è„šæœ¬
â”œâ”€â”€ README_Service.md           # æœåŠ¡è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ llm.py                      # å¤§æ¨¡å‹åŸºç±»ï¼ˆåŸæ–‡ä»¶ï¼‰
â””â”€â”€ main.py                     # ä¸»ç¨‹åºï¼ˆåŸæ–‡ä»¶ï¼‰
```

## ğŸ› ï¸ å®‰è£…å’Œé…ç½®

### 1. ç¯å¢ƒè¦æ±‚

- Python 3.8+
- ç½‘ç»œè¿æ¥ï¼ˆç”¨äºTavilyæœç´¢ï¼‰

### 2. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### 3. é…ç½®APIå¯†é’¥

åœ¨ `web_search_agent_service.py` ä¸­é…ç½®ï¼š

```python
# APIå¯†é’¥é…ç½®
API_KEYS = {
    "sk-test-key-1": "user1",
    "sk-test-key-2": "user2",
    "sk-admin-key": "admin"
}

# å¤§æ¨¡å‹é…ç½®
LLM_CONFIG = {
    "api_key": "your-deepseek-api-key",
    "base_url": "https://api.deepseek.com/v1",
    "model": "deepseek-chat",
    "temperature": 0.7,
    "max_tokens": 4096
}
```

## ğŸš€ å¯åŠ¨æœåŠ¡

### Windows
```cmd
start_service.bat
```

### Linux/Mac
```bash
chmod +x start_service.sh
./start_service.sh
```

### æ‰‹åŠ¨å¯åŠ¨
```bash
python web_search_agent_service.py
```

æœåŠ¡å¯åŠ¨åï¼Œè®¿é—®ï¼š
- æœåŠ¡åœ°å€: http://localhost:8000
- APIæ–‡æ¡£: http://localhost:8000/docs
- äº¤äº’å¼æ–‡æ¡£: http://localhost:8000/redoc

## ğŸ“š APIæ¥å£

### 1. å¥åº·æ£€æŸ¥
```http
GET /health
```

### 2. èŠå¤©æ¥å£ï¼ˆéæµå¼ï¼‰
```http
POST /chat
Authorization: Bearer sk-test-key-1
Content-Type: application/json

{
    "message": "ä»Šå¤©åŒ—äº¬çš„å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ",
    "stream": false,
    "max_tool_calls": 3,
    "system_prompt": "ä½ æ˜¯ä¸€ä¸ªå¤©æ°”ä¸“å®¶"
}
```

### 3. èŠå¤©æ¥å£ï¼ˆæµå¼ï¼‰
```http
POST /chat/stream
Authorization: Bearer sk-test-key-1
Content-Type: application/json

{
    "message": "ä»‹ç»ä¸€ä¸‹äººå·¥æ™ºèƒ½çš„å‘å±•å†å²",
    "stream": true,
    "max_tool_calls": 2
}
```

### 4. ç›´æ¥æœç´¢
```http
POST /search
Authorization: Bearer sk-test-key-1
Content-Type: application/json

{
    "query": "Pythonç¼–ç¨‹è¯­è¨€",
    "max_results": 3
}
```

### 5. è·å–å¯ç”¨å·¥å…·
```http
GET /tools
```

## ğŸ§ª è¿è¡Œæµ‹è¯•

### Windows
```cmd
run_tests.bat
```

### Linux/Mac
```bash
chmod +x run_tests.sh
./run_tests.sh
```

### æ‰‹åŠ¨æµ‹è¯•
```bash
python test_service.py
```

## ğŸ“Š æµ‹è¯•ç”¨ä¾‹

æµ‹è¯•ç¨‹åºåŒ…å«ä»¥ä¸‹æµ‹è¯•ç”¨ä¾‹ï¼š

1. **å¥åº·æ£€æŸ¥æµ‹è¯•** - éªŒè¯æœåŠ¡çŠ¶æ€
2. **æ ¹ç«¯ç‚¹æµ‹è¯•** - éªŒè¯åŸºç¡€API
3. **å·¥å…·ç«¯ç‚¹æµ‹è¯•** - éªŒè¯å·¥å…·å¯ç”¨æ€§
4. **è®¤è¯æµ‹è¯•** - éªŒè¯APIå¯†é’¥éªŒè¯
5. **ç›´æ¥æœç´¢æµ‹è¯•** - éªŒè¯æœç´¢åŠŸèƒ½
6. **èŠå¤©æµ‹è¯•-å¸¸è¯†é—®é¢˜** - éªŒè¯æ— éœ€æœç´¢çš„é—®é¢˜
7. **èŠå¤©æµ‹è¯•-éœ€è¦æœç´¢çš„é—®é¢˜** - éªŒè¯éœ€è¦æœç´¢çš„é—®é¢˜
8. **æµå¼èŠå¤©æµ‹è¯•** - éªŒè¯æµå¼è¾“å‡º
9. **è‡ªå®šä¹‰ç³»ç»Ÿæç¤ºæµ‹è¯•** - éªŒè¯è‡ªå®šä¹‰æç¤ºè¯

## ğŸ” è®¤è¯æœºåˆ¶

æœåŠ¡ä½¿ç”¨Bearer Tokenè®¤è¯ï¼š

```python
headers = {
    "Authorization": "Bearer sk-test-key-1",
    "Content-Type": "application/json"
}
```

é¢„é…ç½®çš„æµ‹è¯•å¯†é’¥ï¼š
- `sk-test-key-1` â†’ `user1`
- `sk-test-key-2` â†’ `user2`
- `sk-admin-key` â†’ `admin`

## âš™ï¸ é…ç½®é€‰é¡¹

### æœåŠ¡é…ç½®
```python
SERVICE_CONFIG = {
    "title": "æ™ºèƒ½æœç´¢åŠ©æ‰‹API",
    "description": "åŸºäºå¤§æ¨¡å‹çš„æ™ºèƒ½æœç´¢å’Œé—®ç­”æœåŠ¡",
    "version": "1.0.0",
    "host": "0.0.0.0",
    "port": 8000,
    "debug": True
}
```

### å¤§æ¨¡å‹é…ç½®
```python
LLM_CONFIG = {
    "api_key": "your-api-key",
    "base_url": "https://api.deepseek.com/v1",
    "model": "deepseek-chat",
    "temperature": 0.7,
    "max_tokens": 4096
}
```

## ğŸ”§ è‡ªå®šä¹‰å’Œæ‰©å±•

### æ·»åŠ æ–°å·¥å…·

1. åœ¨ `main.py` ä¸­å®šä¹‰æ–°å·¥å…·å‡½æ•°
2. åœ¨ `tools` åˆ—è¡¨ä¸­æ·»åŠ å·¥å…·schema
3. åœ¨ `SearchAgentService.tool_functions` ä¸­æ³¨å†Œå·¥å…·

### ä¿®æ”¹ç³»ç»Ÿæç¤ºè¯

åœ¨ `SearchAgentService.chat_with_search` æ–¹æ³•ä¸­ä¿®æ”¹ `optimized_system_prompt`ã€‚

### æ·»åŠ æ–°çš„APIç«¯ç‚¹

åœ¨ `web_search_agent_service.py` ä¸­æ·»åŠ æ–°çš„è·¯ç”±å‡½æ•°ã€‚

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æœåŠ¡å¯åŠ¨å¤±è´¥**
   - æ£€æŸ¥ç«¯å£8000æ˜¯å¦è¢«å ç”¨
   - æ£€æŸ¥Pythonç¯å¢ƒå’Œä¾èµ–åŒ…

2. **APIè°ƒç”¨å¤±è´¥**
   - æ£€æŸ¥APIå¯†é’¥æ˜¯å¦æ­£ç¡®
   - æ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£åœ¨è¿è¡Œ

3. **æœç´¢åŠŸèƒ½å¼‚å¸¸**
   - æ£€æŸ¥ç½‘ç»œè¿æ¥
   - æ£€æŸ¥Tavily APIå¯†é’¥

4. **å¤§æ¨¡å‹è°ƒç”¨å¤±è´¥**
   - æ£€æŸ¥DeepSeek APIå¯†é’¥
   - æ£€æŸ¥ç½‘ç»œè¿æ¥

### æ—¥å¿—æŸ¥çœ‹

æœåŠ¡è¿è¡Œæ—¶ä¼šè¾“å‡ºè¯¦ç»†æ—¥å¿—ï¼ŒåŒ…æ‹¬ï¼š
- æœåŠ¡å¯åŠ¨ä¿¡æ¯
- APIè°ƒç”¨è®°å½•
- å·¥å…·æ‰§è¡Œæ—¥å¿—
- é”™è¯¯ä¿¡æ¯

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### å»ºè®®é…ç½®

1. **è°ƒæ•´max_tool_calls**: æ ¹æ®é—®é¢˜å¤æ‚åº¦è®¾ç½®åˆé€‚çš„å·¥å…·è°ƒç”¨æ¬¡æ•°
2. **ä½¿ç”¨æµå¼è¾“å‡º**: å¯¹äºé•¿å›ç­”ï¼Œä½¿ç”¨æµå¼è¾“å‡ºæå‡ç”¨æˆ·ä½“éªŒ
3. **ç¼“å­˜æœºåˆ¶**: å¯¹äºé‡å¤é—®é¢˜ï¼Œå¯ä»¥å®ç°ç»“æœç¼“å­˜

### ç›‘æ§æŒ‡æ ‡

- å“åº”æ—¶é—´
- å·¥å…·è°ƒç”¨æ¬¡æ•°
- æˆåŠŸç‡
- é”™è¯¯ç‡

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›æœåŠ¡ï¼

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäºæ‚¨ç°æœ‰çš„ä»£ç ï¼Œè¯·éµå¾ªç›¸åº”çš„è®¸å¯è¯æ¡æ¬¾ã€‚

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·ï¼š
1. æŸ¥çœ‹æœ¬æ–‡æ¡£
2. æ£€æŸ¥æ—¥å¿—è¾“å‡º
3. è¿è¡Œæµ‹è¯•ç¨‹åº
4. æäº¤Issueæè¿°é—®é¢˜
